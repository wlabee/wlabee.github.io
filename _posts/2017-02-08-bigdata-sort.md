---
layout: post
title:  "大数据文件的排序"
date:   2017-02-08 14:19:22 +0800
categories: [skill]
excerpt: "一个存放很多整数的文件，对里面的数据进行排序"
tags:
  - Algorithm
---

> 首先说明这跟大数据无关，如果你是因为大数据这个标题，那就不用看下面的了
> 本文只是我看得的几个排序算法
  
-----

## 问题描述。

> 给你1个文件 bigdata ，大小4663M，5亿个数，文件中的数据随机,如下一行一个整数。

说道排序算法，之前了解的也不少，什么快速排序、堆排序、冒泡排序等等，
不过针对这个问题基本是不能使用的，为什么呢？因为数据量太大，内存是有限的，全都读入到内存再排序是不可能的事。

然后就有了，

## 多趟排序：

	由于1M内存最多放262144个int，那么第一趟读一篇文件，取出0-249999之间的数放入内存，进行排序，
	排序算法可以使用快速排序，排序完写入硬盘。第二趟读一遍文件，将250000-499999之间的数都读到内存，
	在进行排序，写入硬盘.....，一直到所有数据都排序完。这样能做到排序的目的，
	但是由于多次读文件带来了巨大的开销。

这个描述是举得一个特例，但是意思是明白的，就是知道里面有些什么数，然后每次读特定范围的一些数，然后排序。

## 位图排序：

	由于整数没有重复，那么可以用比特位来表示整数的存在。
	比如集合  {1，2，5，4，7}，
	可以用位图表示为   01101101，
	由于位图的第1,2,4,5,7为都是1，表示集合里存在着这几个数。
	具体到这个算法实现的时候，由于数最大为10 000 000，那么可以用10 000 000个bit的数组来表示，
	内存大小为 10 000 000/8/1024/1024=1.19MB的内存空间。
	排序算法如下：
	1.根据需要排序的输入中最大和最小的数，设置byte型的数组（为什么不是bit型呢？
	因为计算机处理的最小单元就是byte..1byte=8bit），设置所有位为0。
	2.依次读取输入，某一次读取数据是，在数组那一位设置1，表示包含这个数。
	3.读回，遍历byte数组,如果某一位是1，就表示包含这个数。
	注：涉及到的位操作可以参考《编程珠玑》习题1.6的第二题。

这也是摘录的被人的描述，叙述也很清楚。

## 外部排序：

	把大文件按照一定数量分成小文件，对小文件排序，
	然后挑选，挑选原理就是 “所有文件的最小值，就是各个小文件的最小值中的最小值”，
	依次挑出最小值之后，写入到新的排序文件，删除掉所在行。

	就是一个分、合的过程。

## 比较

多段排序：前提条件是知道里面有些什么数，缺点是对这个大文件多次读取，开销很大。

位图排序：这个的前提条件是数据是整数且没有重复，这种是比较快的排序，条件要求比较苛刻。

外部排序：这种适用比较强，速度也还将就